C51 COMPILER V9.50a   SENSOR_T_H                                                           07/17/2017 17:31:02 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE SENSOR_T_H
OBJECT MODULE PLACED IN SENSOR_T_H.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE SENSOR_T_H.c LARGE OPTIMIZE(7,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*****************************************************************
   2                                       SENSOR.C  file
   3          
   4          Ö÷Òª¹¦ÄÜ£º¸ºÔð¶¨ÒåÎÂÊª¶È´«¸Ð¿ØÖÆº¯ÊýÒÔ¼°ÏàÓ¦±äÁ¿
   5          
   6          ´´½¨Ê±¼ä£º2015.10.31
   7          *****************************************************************/
   8          #include "SENSOR_T_H.h"
   9          #include <STC89C5xRC.h>
  10          #include <intrins.h>
  11          
  12          
  13          bit      Sensor_T_H_Flag;                                        //ÎÂÊª¶È´«¸ÐÆ÷Æô¶¯±êÖ¾Î»
  14          bit      Sensor_T_H_Flag1;                                       //ÎÂÊª¶È´«¸ÐÆ÷¶ÁÈ¡±êÖ¾Î»
  15          bit      T_Or_H;                                                 //0ÎªÎÂ¶È²âÁ¿£¬1ÎªÊª¶È²âÁ¿
  16          
  17          
  18          float Temperature;                                               //ÎÂ¶È²âÁ¿Öµ£¬-40--123.8(ÉãÊÏ¶È)
  19          float Humidity;                                                  //Êª¶È²âÁ¿Öµ£¬0--100£¨%RH£©
  20          unsigned int Sensor_T_H_Counter;                                 //ÎÂÊª¶È´«¸ÐÆ÷¼ÆÊýÆ÷£¬Ã¿¸ô4s½øÐÐÒ»´ÎÎÂ¶È²
             -âÁ¿ºÍÒ»´ÎÊª¶È²âÁ¿
  21          
  22          /*--------------------------------------------------------------*/
  23          /*---------------------ÎÂÊª¶È´«¸ÐÆ÷³õÊ¼»¯----------------------*/
  24          /*--------------------------------------------------------------*/
  25          void init_sensor_t_h()
  26          {
  27   1        T_H_Sck=0;
  28   1        T_H_Data=1;
  29   1        Sensor_T_H_Flag=0;
  30   1        Sensor_T_H_Flag1=0;
  31   1        T_Or_H=0;
  32   1        Sensor_T_H_Counter=0;
  33   1        Temperature=0;
  34   1        Humidity=0;
  35   1      }
  36          
  37          /*--------------------------------------------------------------*/
  38          /*----------------------Æô¶¯ÎÂÊª¶È´«¸ÐÆ÷-----------------------*/
  39          /*--------------------------------------------------------------*/
  40          void star_sensor_t_h()
  41          {
  42   1        if(T_Or_H)                                               //Æô¶¯Êª¶È²âÁ¿
  43   1        {
  44   2          /*------------------------Æô¶¯´«ÊäÐÅºÅ---------------------*/
  45   2          T_H_Sck=1;
  46   2          _nop_();
  47   2          T_H_Data=0;
  48   2          _nop_();
  49   2          T_H_Sck=0;
  50   2          _nop_();
  51   2          _nop_();
  52   2          T_H_Sck=1;
  53   2          _nop_();
  54   2          T_H_Data=1;
C51 COMPILER V9.50a   SENSOR_T_H                                                           07/17/2017 17:31:02 PAGE 2   

  55   2          _nop_();
  56   2          T_H_Sck=0;
  57   2          _nop_();
  58   2          /*-----------------------Ð´µØÖ·£¨000£©---------------------*/
  59   2          T_H_Data=0;
  60   2          _nop_();
  61   2          T_H_Sck=1;
  62   2          _nop_();
  63   2          _nop_();
  64   2          T_H_Sck=0;
  65   2          _nop_();
  66   2          _nop_();
  67   2          T_H_Sck=1;
  68   2          _nop_();
  69   2          _nop_();
  70   2          T_H_Sck=0;
  71   2          _nop_();
  72   2          _nop_();
  73   2          T_H_Sck=1;
  74   2          _nop_();
  75   2          _nop_();
  76   2          T_H_Sck=0;
  77   2          _nop_();
  78   2          _nop_();
  79   2          /*----------Ð´ÃüÁî£¨00101£¬Æô¶¯Êª¶È²âÁ¿ÃüÁî£©-------------*/
  80   2          T_H_Sck=1;
  81   2          _nop_();
  82   2          _nop_();
  83   2          T_H_Sck=0;
  84   2          _nop_();
  85   2          _nop_();
  86   2          T_H_Sck=1;
  87   2          _nop_();
  88   2          _nop_();
  89   2          T_H_Sck=0;
  90   2          _nop_();
  91   2          T_H_Data=1;
  92   2          _nop_();
  93   2          T_H_Sck=1;
  94   2          _nop_();
  95   2          _nop_();
  96   2          T_H_Sck=0;
  97   2          _nop_();
  98   2          T_H_Data=0;
  99   2          _nop_();
 100   2          T_H_Sck=1;
 101   2          _nop_();
 102   2          _nop_();
 103   2          T_H_Sck=0;
 104   2          _nop_();
 105   2          T_H_Data=1;
 106   2          _nop_();
 107   2          T_H_Sck=1;
 108   2          _nop_();
 109   2          _nop_();
 110   2          /*------------------------¶ÁÈ¡Ó¦´ðÐÅºÅ---------------------*/
 111   2          T_H_Sck=0;
 112   2          _nop_();
 113   2          _nop_();
 114   2          T_H_Sck=1;
 115   2          _nop_();
 116   2          _nop_();
C51 COMPILER V9.50a   SENSOR_T_H                                                           07/17/2017 17:31:02 PAGE 3   

 117   2          T_H_Sck=0;
 118   2        }
 119   1        
 120   1        else                                                     //Æô¶¯ÎÂ¶È²âÁ¿
 121   1        {
 122   2           /*------------------------Æô¶¯´«ÊäÐÅºÅ---------------------*/
 123   2          T_H_Sck=1;
 124   2          _nop_();
 125   2          T_H_Data=0;
 126   2          _nop_();
 127   2          T_H_Sck=0;
 128   2          _nop_();
 129   2          _nop_();
 130   2          T_H_Sck=1;
 131   2          _nop_();
 132   2          T_H_Data=1;
 133   2          _nop_();
 134   2          T_H_Sck=0;
 135   2          _nop_();
 136   2          /*-----------------------Ð´µØÖ·£¨000£©---------------------*/
 137   2          T_H_Data=0;
 138   2          _nop_();
 139   2          T_H_Sck=1;
 140   2          _nop_();
 141   2          _nop_();
 142   2          T_H_Sck=0;
 143   2          _nop_();
 144   2          _nop_();
 145   2          T_H_Sck=1;
 146   2          _nop_();
 147   2          _nop_();
 148   2          T_H_Sck=0;
 149   2          _nop_();
 150   2          _nop_();
 151   2          T_H_Sck=1;
 152   2          _nop_();
 153   2          _nop_();
 154   2          T_H_Sck=0;
 155   2          _nop_();
 156   2          _nop_();
 157   2          /*----------Ð´ÃüÁî£¨00011£¬Æô¶¯ÎÂ¶È²âÁ¿ÃüÁî£©-------------*/
 158   2          T_H_Sck=1;
 159   2          _nop_();
 160   2          _nop_();
 161   2          T_H_Sck=0;
 162   2          _nop_();
 163   2          _nop_();
 164   2          T_H_Sck=1;
 165   2          _nop_();
 166   2          _nop_();
 167   2          T_H_Sck=0;
 168   2          _nop_();
 169   2          T_H_Data=0;
 170   2          _nop_();
 171   2          T_H_Sck=1;
 172   2          _nop_();
 173   2          _nop_();
 174   2          T_H_Sck=0;
 175   2          _nop_();
 176   2          T_H_Data=1;
 177   2          _nop_();
 178   2          T_H_Sck=1;
C51 COMPILER V9.50a   SENSOR_T_H                                                           07/17/2017 17:31:02 PAGE 4   

 179   2          _nop_();
 180   2          _nop_();
 181   2          T_H_Sck=0;
 182   2          _nop_();
 183   2          T_H_Data=1;
 184   2          _nop_();
 185   2          T_H_Sck=1;
 186   2          _nop_();
 187   2          _nop_();
 188   2          /*------------------------¶ÁÈ¡Ó¦´ðÐÅºÅ---------------------*/
 189   2          T_H_Sck=0;
 190   2          _nop_();
 191   2          _nop_();
 192   2          T_H_Sck=1;
 193   2          _nop_();
 194   2          _nop_();
 195   2          T_H_Sck=0;
 196   2        }
 197   1        
 198   1        Sensor_T_H_Flag=0;
 199   1        Sensor_T_H_Flag1=1;
 200   1      }
 201          
 202          /*--------------------------------------------------------------*/
 203          /*----------------------¶ÁÈ¡ÎÂÊª¶È´«¸ÐÆ÷-----------------------*/
 204          /*--------------------------------------------------------------*/
 205          void read_sensor_t_h()
 206          {
 207   1        unsigned int T_H_Temp=0;                                 //ÁÙÊ±±äÁ¿£¬ÓÃÓÚ´æ·Å´ÓSH10ÖÐ¶ÁÈ¡µÄÎÂ¶ÈÖµ»òÕßÊª¶È
             -Öµ£¨AD×ª»»ºó£©£¬ÐèÒª×ª»»ºó²ÅÄÜµÃµ½ÕæÕýµÄÎÂ¶ÈºÍÊª¶È
 208   1        unsigned char i;
 209   1        if(T_Or_H)                                               //¶ÁÈ¡Êª¶È²âÁ¿Öµ
 210   1        {
 211   2          /*-----------------------¶ÁÈ¡ÎÞÐ§Î»(0000)-------------------*/
 212   2          T_H_Sck=1;
 213   2          _nop_();
 214   2          _nop_();
 215   2          T_H_Sck=0;
 216   2          _nop_();
 217   2          _nop_();
 218   2          T_H_Sck=1;
 219   2          _nop_();
 220   2          _nop_();
 221   2          T_H_Sck=0;
 222   2          _nop_();
 223   2          _nop_();
 224   2          T_H_Sck=1;
 225   2          _nop_();
 226   2          _nop_();
 227   2          T_H_Sck=0;
 228   2          _nop_();
 229   2          _nop_();
 230   2          T_H_Sck=1;
 231   2          _nop_();
 232   2          _nop_();
 233   2          T_H_Sck=0;
 234   2          _nop_();
 235   2          _nop_();
 236   2          /*--------------------------¶ÁÈ¡¸ß4Î»-----------------------*/
 237   2          for(i=0;i<4;i++)
 238   2          {
 239   3            T_H_Sck=1;
C51 COMPILER V9.50a   SENSOR_T_H                                                           07/17/2017 17:31:02 PAGE 5   

 240   3            T_H_Temp=T_H_Temp<<1;
 241   3            T_H_Temp=T_H_Temp|T_H_Data;
 242   3            T_H_Sck=0;
 243   3            _nop_();
 244   3            _nop_();
 245   3          }
 246   2          /*-----------------------·¢ËÍÓ¦´ðÐÅºÅ-----------------------*/
 247   2          T_H_Data=0;
 248   2          _nop_();
 249   2          T_H_Sck=1;
 250   2          _nop_();
 251   2          _nop_();
 252   2          T_H_Sck=0;
 253   2          _nop_();
 254   2          _nop_();
 255   2          /*--------------------------¶ÁÈ¡µÍ8Î»-----------------------*/
 256   2          for(i=0;i<8;i++)
 257   2          {
 258   3            T_H_Sck=1;
 259   3            T_H_Temp=T_H_Temp<<1;
 260   3            T_H_Temp=T_H_Temp|T_H_Data;
 261   3            T_H_Sck=0;
 262   3            _nop_();
 263   3            _nop_();
 264   3          }
 265   2          /*-------------·¢ËÍ·ÇÓ¦´ðÐÅºÅ£¬Ìø¹ýCRCÐ§Ñé-----------------*/
 266   2          T_H_Data=1;                                        //·ÇÓ¦´ðÐÅºÅ
 267   2          _nop_();
 268   2          T_H_Sck=1;
 269   2          _nop_();
 270   2          _nop_();
 271   2          T_H_Sck=0;
 272   2          _nop_();
 273   2          _nop_();
 274   2          /*---------------------------Êª¶È×ª»»-----------------------*/
 275   2          Humidity=0.0367*T_H_Temp-1.5955e-6*T_H_Temp*T_H_Temp-2.0468;
 276   2        }
 277   1        
 278   1        else                                                     //¶ÁÈ¡ÎÂ¶È²âÁ¿Öµ
 279   1        {
 280   2          /*------------------------¶ÁÈ¡ÎÞÐ§Î»(00)--------------------*/
 281   2          T_H_Sck=1;
 282   2          _nop_();
 283   2          _nop_();
 284   2          T_H_Sck=0;
 285   2          _nop_();
 286   2          _nop_();
 287   2          T_H_Sck=1;
 288   2          _nop_();
 289   2          _nop_();
 290   2          T_H_Sck=0;
 291   2          _nop_();
 292   2          _nop_();
 293   2          /*--------------------------¶ÁÈ¡¸ß6Î»-----------------------*/
 294   2          for(i=0;i<6;i++)
 295   2          {
 296   3            T_H_Sck=1;
 297   3            T_H_Temp=T_H_Temp<<1;
 298   3            T_H_Temp=T_H_Temp|T_H_Data;
 299   3            T_H_Sck=0;
 300   3            _nop_();
 301   3            _nop_();
C51 COMPILER V9.50a   SENSOR_T_H                                                           07/17/2017 17:31:02 PAGE 6   

 302   3          }
 303   2          /*-----------------------·¢ËÍÓ¦´ðÐÅºÅ-----------------------*/
 304   2          T_H_Data=0;
 305   2          _nop_();
 306   2          T_H_Sck=1;
 307   2          _nop_();
 308   2          _nop_();
 309   2          T_H_Sck=0;
 310   2          _nop_();
 311   2          _nop_();
 312   2          /*--------------------------¶ÁÈ¡µÍ8Î»-----------------------*/
 313   2          for(i=0;i<8;i++)
 314   2          {
 315   3            T_H_Sck=1;
 316   3            T_H_Temp=T_H_Temp<<1;
 317   3            T_H_Temp=T_H_Temp|T_H_Data;
 318   3            T_H_Sck=0;
 319   3            _nop_();
 320   3            _nop_();
 321   3          }
 322   2          /*-------------·¢ËÍ·ÇÓ¦´ðÐÅºÅ£¬Ìø¹ýCRCÐ§Ñé-----------------*/
 323   2          T_H_Data=1;                                        //·ÇÓ¦´ðÐÅºÅ
 324   2          _nop_();
 325   2          T_H_Sck=1;
 326   2          _nop_();
 327   2          _nop_();
 328   2          T_H_Sck=0;
 329   2          _nop_();
 330   2          _nop_();
 331   2          /*---------------------------ÎÂ¶È×ª»»-----------------------*/
 332   2          Temperature=0.01*T_H_Temp-40.1;
 333   2        }
 334   1        
 335   1        Sensor_T_H_Flag1=0;
 336   1        T_Or_H=~T_Or_H;                                         //ÎÂ¶È²âÁ¿ºÍÊª¶È²âÁ¿ÂÖÁ÷½øÐÐ
 337   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    719    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     10       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
